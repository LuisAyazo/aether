<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Persistencia de Viewport</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #666;
            margin-top: 0;
        }
        .log {
            background-color: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
            font-family: monospace;
            font-size: 14px;
        }
        .error {
            border-left-color: #f44336;
            background-color: #ffebee;
        }
        .info {
            border-left-color: #2196F3;
            background-color: #e3f2fd;
        }
        .success {
            border-left-color: #4CAF50;
            background-color: #e8f5e9;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #45a049;
        }
        .viewport-display {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border: 1px solid #ddd;
        }
        .viewport-display h3 {
            margin-top: 0;
            color: #666;
        }
        .viewport-value {
            font-family: monospace;
            color: #333;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Test de Persistencia de Viewport en InfraUX</h1>

    <div class="test-section">
        <h2>üìç Logs de Viewport</h2>
        <p>Estos son los logs que deber√≠as ver en la consola cuando uses la aplicaci√≥n:</p>
        
        <div class="log info">üìç [VIEWPORT LOAD] Loading viewport from currentDiagram: {x: 100, y: 50, zoom: 0.8}</div>
        <div class="log info">üìç [VIEWPORT INIT] Setting initial viewport: {x: 100, y: 50, zoom: 0.8}</div>
        <div class="log success">üìç [VIEWPORT UPDATE] Viewport changed: {x: 150, y: 75, zoom: 1.2}</div>
        <div class="log success">üìç [VIEWPORT SAVE TRIGGER] Triggering save after timeout</div>
        <div class="log success">üìç [VIEWPORT SAVE] Saving diagram state: {nodeCount: 5, edgeCount: 3, viewport: {...}, source: 'lastViewportRef'}</div>
        <div class="log info">üìç [VIEWPORT CLEANUP] Component unmounting, saving current state</div>
    </div>

    <div class="test-section">
        <h2>üß™ Pasos para Probar la Persistencia</h2>
        <ol>
            <li><strong>Abre la consola del navegador</strong> (F12)</li>
            <li><strong>Navega a un diagrama</strong></li>
            <li><strong>Haz zoom y mueve el canvas</strong></li>
            <li><strong>Espera 1 segundo</strong> - Deber√≠as ver el log de guardado</li>
            <li><strong>Cambia a otro diagrama o ambiente</strong></li>
            <li><strong>Vuelve al diagrama original</strong></li>
            <li><strong>Verifica que mantenga la posici√≥n y zoom</strong></li>
        </ol>
    </div>

    <div class="test-section">
        <h2>üîç Valores Esperados del Viewport</h2>
        <div class="viewport-display">
            <h3>Viewport Inicial (Default)</h3>
            <div class="viewport-value">x: 0</div>
            <div class="viewport-value">y: 0</div>
            <div class="viewport-value">zoom: 1</div>
        </div>
        
        <div class="viewport-display">
            <h3>Viewport Guardado (Ejemplo)</h3>
            <div class="viewport-value">x: 150.5</div>
            <div class="viewport-value">y: -75.2</div>
            <div class="viewport-value">zoom: 0.85</div>
        </div>
    </div>

    <div class="test-section">
        <h2>‚ùó Problemas Comunes</h2>
        <ul>
            <li><strong>El viewport no se guarda:</strong> Verifica que aparezca el log "VIEWPORT SAVE" despu√©s de mover el canvas</li>
            <li><strong>El viewport no se carga:</strong> Verifica que aparezca el log "VIEWPORT LOAD" al cargar el diagrama</li>
            <li><strong>Se pierde al cambiar de diagrama:</strong> Verifica que aparezca el log "VIEWPORT CLEANUP" al cambiar</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üöÄ Soluci√≥n Implementada</h2>
        <p>La soluci√≥n incluye:</p>
        <ul>
            <li>‚úÖ Viewport controlado en lugar de defaultViewport</li>
            <li>‚úÖ Uso del evento onMove en lugar de onViewportChange</li>
            <li>‚úÖ Guardado autom√°tico despu√©s de 1 segundo de inactividad</li>
            <li>‚úÖ Guardado forzado al cambiar de diagrama</li>
            <li>‚úÖ Logs detallados para depuraci√≥n</li>
        </ul>
    </div>

    <script>
        console.log('Test de Viewport cargado. Abre InfraUX y sigue los pasos de prueba.');
    </script>
</body>
</html>
